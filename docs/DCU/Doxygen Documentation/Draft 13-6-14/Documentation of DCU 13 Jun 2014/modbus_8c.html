<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>SiteSync Stage-1: src/modbus.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SiteSync Stage-1
   &#160;<span id="projectnumber">VER 1.0</span>
   </div>
   <div id="projectbrief">SiteSync</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('modbus_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">modbus.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Provides API's to fill request packet and to parse the response packet gets from device.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="common_8h_source.html">common.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="modbus_8h_source.html">modbus.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="interface_8h_source.html">interface.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bms_8h_source.html">bms.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="connection_8h_source.html">connection.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ethernet_8h_source.html">ethernet.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="serial_8h_source.html">serial.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="device_8h_source.html">device.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="storage__pool_8h_source.html">storage_pool.h</a>&quot;</code><br/>
</div>
<p><a href="modbus_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab06b210fedce4743519a914c05e718a6"><td class="memItemLeft" align="right" valign="top">unsigned short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="modbus_8c.html#ab06b210fedce4743519a914c05e718a6">CalculateCheckSum</a> (unsigned char *Packet, int PacketLength)</td></tr>
<tr class="memdesc:ab06b210fedce4743519a914c05e718a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">calculation of the CRC according for standard modbus protocol.  <a href="#ab06b210fedce4743519a914c05e718a6">More...</a><br/></td></tr>
<tr class="separator:ab06b210fedce4743519a914c05e718a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ae5a11d0eb508f0630da1dcb76558df"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="modbus_8c.html#a6ae5a11d0eb508f0630da1dcb76558df">VerifyCRC</a> (unsigned char *Buffer)</td></tr>
<tr class="memdesc:a6ae5a11d0eb508f0630da1dcb76558df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifing checksum of received packet.  <a href="#a6ae5a11d0eb508f0630da1dcb76558df">More...</a><br/></td></tr>
<tr class="separator:a6ae5a11d0eb508f0630da1dcb76558df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36f0f2e50d352037e7462766ce1fd21b"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="modbus_8c.html#a36f0f2e50d352037e7462766ce1fd21b">ParseMBRTUResp</a> (<a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *ModbusInfo, unsigned char *Buffer, unsigned char Media, unsigned long ReqCommAddr, unsigned short TransactionId)</td></tr>
<tr class="memdesc:a36f0f2e50d352037e7462766ce1fd21b"><td class="mdescLeft">&#160;</td><td class="mdescRight">It parse response packet comes over the modbus.Parsing response packet received from modbus tcp or modbus serial.  <a href="#a36f0f2e50d352037e7462766ce1fd21b">More...</a><br/></td></tr>
<tr class="separator:a36f0f2e50d352037e7462766ce1fd21b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29ecee63561f473bfbae41501d880928"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="modbus_8c.html#a29ecee63561f473bfbae41501d880928">FillMBRTUReq</a> (unsigned char Media, <a class="el" href="struct_p_o_l_l_i_n_g___i_n_f_o.html">POLLING_INFO</a> *PollingRef)</td></tr>
<tr class="memdesc:a29ecee63561f473bfbae41501d880928"><td class="mdescLeft">&#160;</td><td class="mdescRight">API to fill request packet that would be send over modbus tcp or modbus serial based on the media type.  <a href="#a29ecee63561f473bfbae41501d880928">More...</a><br/></td></tr>
<tr class="separator:a29ecee63561f473bfbae41501d880928"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec649a1e91803a0ce4493062a5181775"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="modbus_8c.html#aec649a1e91803a0ce4493062a5181775">FillModbusReq</a> (<a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *ModbusReqInfo, unsigned char *Buffer, unsigned char Media)</td></tr>
<tr class="memdesc:aec649a1e91803a0ce4493062a5181775"><td class="mdescLeft">&#160;</td><td class="mdescRight">API to fill request packet that would be send over modbus tcp or modbus serial.  <a href="#aec649a1e91803a0ce4493062a5181775">More...</a><br/></td></tr>
<tr class="separator:aec649a1e91803a0ce4493062a5181775"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb094d634f10271b83179f3982b9dc1d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="modbus_8c.html#afb094d634f10271b83179f3982b9dc1d">GetDataFromStoragePool</a> (<a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *ModbusInfo, unsigned char *Buffer)</td></tr>
<tr class="memdesc:afb094d634f10271b83179f3982b9dc1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">API used for getting data stored from pool for BMS request.It will search for slave address in BMS Info to get index of BMS Info, at that index we get storage reference pool which holds data / status of the device and get filled from referennce into response buffer.  <a href="#afb094d634f10271b83179f3982b9dc1d">More...</a><br/></td></tr>
<tr class="separator:afb094d634f10271b83179f3982b9dc1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ef16a7eafa6ce380e77ec57b7aa7bc2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="modbus_8c.html#a2ef16a7eafa6ce380e77ec57b7aa7bc2">ValidateBMSReqParam</a> (<a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *ModbusInfo)</td></tr>
<tr class="memdesc:a2ef16a7eafa6ce380e77ec57b7aa7bc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">API validate the request packet from BMS.It wil compare request packet with BMS Info filled from XML file.  <a href="#a2ef16a7eafa6ce380e77ec57b7aa7bc2">More...</a><br/></td></tr>
<tr class="separator:a2ef16a7eafa6ce380e77ec57b7aa7bc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0b945cf0ff358e1bd8eca0dfaf58890"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="modbus_8c.html#af0b945cf0ff358e1bd8eca0dfaf58890">ParseBMSModbusReq</a> (<a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *ModbusInfo, unsigned char *Buffer, unsigned char ModbusType, unsigned char InterfaceIdx)</td></tr>
<tr class="memdesc:af0b945cf0ff358e1bd8eca0dfaf58890"><td class="mdescLeft">&#160;</td><td class="mdescRight">It parse request packet comes over the modbus from BMS. It request for data / status of particular BMS register address.  <a href="#af0b945cf0ff358e1bd8eca0dfaf58890">More...</a><br/></td></tr>
<tr class="separator:af0b945cf0ff358e1bd8eca0dfaf58890"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add35dc861871d170432b99b306088af5"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="modbus_8c.html#add35dc861871d170432b99b306088af5">FillBMSModbusResp</a> (<a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *ModbusInfo, unsigned char *Buffer, unsigned char ModbusType, unsigned char InterfaceIdx)</td></tr>
<tr class="memdesc:add35dc861871d170432b99b306088af5"><td class="mdescLeft">&#160;</td><td class="mdescRight">API to fill response packet to send over modbus tcp or modbus serial to the BMS.  <a href="#add35dc861871d170432b99b306088af5">More...</a><br/></td></tr>
<tr class="separator:add35dc861871d170432b99b306088af5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f2976a8c456c275a4247d62c7fe89b8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="modbus_8c.html#a6f2976a8c456c275a4247d62c7fe89b8">FillErrorCode</a> (<a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *ModbusInfo, unsigned char *Buffer, unsigned char ModbusType, unsigned char InterfaceIdx, int ErrorCode)</td></tr>
<tr class="memdesc:a6f2976a8c456c275a4247d62c7fe89b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fill error code in response packet to BMS as we got invalid request packet from BMS.  <a href="#a6f2976a8c456c275a4247d62c7fe89b8">More...</a><br/></td></tr>
<tr class="separator:a6f2976a8c456c275a4247d62c7fe89b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Provides API's to fill request packet and to parse the response packet gets from device. </p>

<p>Definition in file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab06b210fedce4743519a914c05e718a6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned short CalculateCheckSum </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>Packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>PacketLength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>calculation of the CRC according for standard modbus protocol. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Packet</td><td>Specifies buffer of which CRC is to be calculated. </td></tr>
    <tr><td class="paramname">PacketLength</td><td>Specifies Length of buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>calculated CRC. </dd></dl>

<p>Definition at line <a class="el" href="modbus_8c_source.html#l00068">68</a> of file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>

</div>
</div>
<a class="anchor" id="add35dc861871d170432b99b306088af5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char FillBMSModbusResp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *&#160;</td>
          <td class="paramname"><em>ModbusInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>ModbusType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>InterfaceIdx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>API to fill response packet to send over modbus tcp or modbus serial to the BMS. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ModbusInfo</td><td>is the structure win which the data is filled which is needed to be copied in the buffer. </td></tr>
    <tr><td class="paramname">Buffer</td><td>Specifies packet to be filled for response to BMS request. </td></tr>
    <tr><td class="paramname">ModbusType</td><td>Specifies it can be modbus ASCII or RTU. </td></tr>
    <tr><td class="paramname">InterfaceIdx</td><td>Specifies interface index of the media to identify whether we got request over TCP or serial. In case of Modbus TCP header contains extra parameters compare TCP Modbus serial.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Offet Specifies number of bytes filled in response packet. </dd></dl>

<p>Definition at line <a class="el" href="modbus_8c_source.html#l00746">746</a> of file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6f2976a8c456c275a4247d62c7fe89b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int FillErrorCode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *&#160;</td>
          <td class="paramname"><em>ModbusInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>ModbusType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>InterfaceIdx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ErrorCode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fill error code in response packet to BMS as we got invalid request packet from BMS. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ModbusInfo</td><td>is the reference to the structure in which the requested data is stored. </td></tr>
    <tr><td class="paramname">Buffer</td><td>is used to contain the data that need to be send to device to inform the error. </td></tr>
    <tr><td class="paramname">ModbusType</td><td>Specifies it can be modbus ASCII or RTU. </td></tr>
    <tr><td class="paramname">InterfaceIdx</td><td>Specifies interface index of the media to identify whether we got request over TCP or serial. In case of Modbus TCP header contains extra parameters compare TCP Modbus serial. </td></tr>
    <tr><td class="paramname">ErrorCode</td><td>It informs modbus master invalid parameters that we got in BMS request packet.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Offet Number of bytes filled in packet. </dd></dl>

<p>Definition at line <a class="el" href="modbus_8c_source.html#l00866">866</a> of file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>

</div>
</div>
<a class="anchor" id="a29ecee63561f473bfbae41501d880928"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int FillMBRTUReq </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>Media</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_p_o_l_l_i_n_g___i_n_f_o.html">POLLING_INFO</a> *&#160;</td>
          <td class="paramname"><em>PollingRef</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>API to fill request packet that would be send over modbus tcp or modbus serial based on the media type. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Media</td><td>specifies devices connected over which interface. E.g Modbus TCP or Modbus Serial e.e RS485. </td></tr>
    <tr><td class="paramname">PollingRef</td><td>It contains reference of the device which contains information required for request over modbus tcp/modbus serial. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns 0 as now no use. </dd></dl>
<p>&lt; Polling information that need to be filled during command modbus packet.</p>
<p>&lt; Local buffer to send the data request.</p>
<p>&lt; Length of the data that has to be send over modbus TCP </p>

<p>Definition at line <a class="el" href="modbus_8c_source.html#l00223">223</a> of file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>

</div>
</div>
<a class="anchor" id="aec649a1e91803a0ce4493062a5181775"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char FillModbusReq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *&#160;</td>
          <td class="paramname"><em>ModbusReqInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>Media</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>API to fill request packet that would be send over modbus tcp or modbus serial. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ModbusReqInfo</td><td>Specifies information required for request over modbus tcp/modbus serial. </td></tr>
    <tr><td class="paramname">Buffer</td><td>Specifies packet to be filled for request. </td></tr>
    <tr><td class="paramname">Media</td><td>Specifies devices connected over which interface. E.g Modbus TCP or Modbus Serial e.e RS485.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Offet Number of bytes filled in packet. </dd></dl>

<p>Definition at line <a class="el" href="modbus_8c_source.html#l00308">308</a> of file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>

</div>
</div>
<a class="anchor" id="afb094d634f10271b83179f3982b9dc1d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GetDataFromStoragePool </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *&#160;</td>
          <td class="paramname"><em>ModbusInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>Buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>API used for getting data stored from pool for BMS request.It will search for slave address in BMS Info to get index of BMS Info, at that index we get storage reference pool which holds data / status of the device and get filled from referennce into response buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ModbusInfo</td><td>Specifies parsed packet of BMS request.i.e slave address, register type, BMS register address. </td></tr>
    <tr><td class="paramname">Buffer</td><td>Specifies stores data / status value for response.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns number of bytes stored in case of success. -1 in case the register is not present in list. </dd></dl>

<p>Definition at line <a class="el" href="modbus_8c_source.html#l00371">371</a> of file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>

</div>
</div>
<a class="anchor" id="af0b945cf0ff358e1bd8eca0dfaf58890"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ParseBMSModbusReq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *&#160;</td>
          <td class="paramname"><em>ModbusInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>ModbusType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>InterfaceIdx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>It parse request packet comes over the modbus from BMS. It request for data / status of particular BMS register address. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ModbusInfo</td><td>It is a out parameter which will have the details of packets. </td></tr>
    <tr><td class="paramname">Buffer</td><td>Specifies actual bytes that we get as request packet over Modbus. </td></tr>
    <tr><td class="paramname">ModbusType</td><td>Specifies the type of Modbus protocol, modbus ASCII or RTU. </td></tr>
    <tr><td class="paramname">InterfaceIdx</td><td>Specifies the interface index of the communication media to identify whether we got request over TCP or serial. In case of Modbus TCP header contains extra parameters compare TCP Modbus serial. So read that extra bytes in that case.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns no of bytes read or ERROR VALUE if CRC of received packet is invalid in case of RS485. </dd></dl>

<p>Definition at line <a class="el" href="modbus_8c_source.html#l00653">653</a> of file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>

</div>
</div>
<a class="anchor" id="a36f0f2e50d352037e7462766ce1fd21b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char ParseMBRTUResp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *&#160;</td>
          <td class="paramname"><em>ModbusInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>Media</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>ReqCommAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>TransactionId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>It parse response packet comes over the modbus.Parsing response packet received from modbus tcp or modbus serial. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ModbusInfo</td><td>Specifies Read received packet and fill it in poll info. </td></tr>
    <tr><td class="paramname">Buffer</td><td>Specifies actual bytes that we get as response over modbus. </td></tr>
    <tr><td class="paramname">Media</td><td>Specifies devices connected over which interface. E.g Modbus TCP or Modbus Serial e.e RS485. </td></tr>
    <tr><td class="paramname">ReqCommAddr</td><td>is the communication slave address for which we have sent the request. </td></tr>
    <tr><td class="paramname">TransactionId</td><td>is the unique for distinguishing the event.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns No of bytes read or ERROR VALUE if CRC of received packet is invalid. </dd></dl>

<p>Definition at line <a class="el" href="modbus_8c_source.html#l00140">140</a> of file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2ef16a7eafa6ce380e77ec57b7aa7bc2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ValidateBMSReqParam </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_m_o_d_b_u_s___r_e_q___i_n_f_o.html">MODBUS_REQ_INFO</a> *&#160;</td>
          <td class="paramname"><em>ModbusInfo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>API validate the request packet from BMS.It wil compare request packet with BMS Info filled from XML file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ModbusInfo</td><td>Specifies parsed packet of BMS request.i.e slave address, register type, BMS register address.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns Error code based on invalid parameter of request packet. If all parameters are validated then returns success flag as zero. </dd></dl>

<p>Definition at line <a class="el" href="modbus_8c_source.html#l00544">544</a> of file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6ae5a11d0eb508f0630da1dcb76558df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char VerifyCRC </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>Buffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verifing checksum of received packet. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Buffer</td><td>Specifies bytes for crc verfification.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>CRC matched or not matched. If mis-matched return ERROR VALUE as -1 and in case of success as 1. </dd></dl>

<p>Definition at line <a class="el" href="modbus_8c_source.html#l00091">91</a> of file <a class="el" href="modbus_8c_source.html">modbus.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="modbus_8c.html">modbus.c</a></li>
    <li class="footer">Generated on Thu Jun 12 2014 20:35:59 for SiteSync Stage-1 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
